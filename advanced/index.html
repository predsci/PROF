<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="PROF Team">
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>PROF-Advanced Topics - PROF</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "PROF-Advanced Topics";
    var mkdocs_page_input_path = "advanced.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> PROF</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../about/">About</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../install/">Install</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../tutorial/">PROF-Shiny Tutorial</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../example/">PROF Command Line Tutorial</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">PROF-Advanced Topics</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#selecting-the-number-of-values-for-rt">Selecting the number of values for R(t)</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#uploading-your-own-data">Uploading Your Own Data</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#editing-the-parameter-file">Editing the Parameter File</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#inferring-mortality">Inferring Mortality</a>
    </li>
    </ul>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">PROF</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>PROF-Advanced Topics</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/predsci/PROF/blob/master/mkdocs/docs/advanced.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="prof-advanced-topics">PROF Advanced Topics</h1>
<p>The observed time-series data for both COVID-19 and influenza can be rather intricate, even within a single season. For instance, during the 2023-2024 season, many states (such as CA, FL, GA) experienced two distinct waves of COVID-19. Similarly, influenza can exhibit a dual wave attributed to different strains, e.g. influenza A and B. Whereas the PROF mechanistic framework includes only a single strain for each pathogen it does attempt to fit and forecast these complex time-series by employing a flexible time-dependent term for the force of infection. PROF uses a smoothly varying two- or three-value functional form to describe the time-dependent reproduction number, R(t) = β(t)γ where β(t) is the time-dependent transmision rate and γ is the total recovery rate. The first advanced topic we discuss is the choice of number of values for R(t), two vs. three. We illustrate this with the 2023-2024 COVID-19 time-series data for CA. We note that the example we show is somewhat extreme and not typical. It shows how a two-value fit to the data fails whereas the three-value fit is quite good. In general, we recommend starting with a two-value model and trying the three-value model only if the two-value one fails.</p>
<h2 id="selecting-the-number-of-values-for-rt">Selecting the number of values for R(t)</h2>
<p>Suppose that we are trying to fit the CA COVID-19 time-series for 2023-2024 from July 1st, 2023 to December 31, 2023 (dashed vertical line in the figure below): the data shows a peak in the late summer/fall and the start of winter wave.</p>
<p><img alt="Figure 1: California, COVID-19 daily new reported hospitalization 2023-2024" src="../img/ca_covid19_data.png" /></p>
<p>We start by selecting the SEIRH model, the two-value option for the force of infection and start and end dates of July 1, 2023 and December 2023, respectively. These choices are shown in the figure below.</p>
<p><img alt="Figure 2: California selecting a two-value FOI to fit the 2023-24 season starting on July 1, 2023 and ending in December 31, 2023." src="../img/prof_ca_selection_2value.png" /></p>
<p>The results of this fit are poor. In the figure below black circles are reported data and shaded areas are the median, 50% and 95% confidence intervals. We see that the two value model is unable to fit the early peak and winter rise and is settling into a single broad peak. Clearly this fit would result in a poor forecast.</p>
<p><img alt="Figure 3: California, fitting the COVID-19 time series with a two-value force of infection." src="../img/ca_fitcovid_2value.png" /></p>
<p>Given these poor results we will now repeat the fit with a three-value model and the results of this fit are shown below. We see that the more flexible three-value model improves the fit significantly although even this fit is not perfect: the rise in the second wave in the model is slower than the observed data.</p>
<p><img alt="Figure 4: Same as above but with a three-value force of infection." src="../img/ca_fitcovid_3value.png" /></p>
<p>We note that as the season progresses the fit with a two-value force of infection improves and is able to fit the two peaks: using one value for each peak (see below). This example demonstrates the complexity of the fits and our somewhat limited ability to control the convergence of the optimization procedure. As discussed below, our 'control knobs' are limited to the minimum and maximum values we explore in the search for optimal parameters.</p>
<p><img alt="Figure 5: California, fitting the COVID-19 time series with a two-value force of infection but later in the season, with data up to February 24, 2024." src="../img/ca_fitcovid_2value_long.png" /></p>
<p>To conclude, this example demonstrates the need to experiment with the mechanistic models. We suggest starting with a two-value force of infection and if the results are not-satisfactory to try and repeat the fit with a three value model. If no improvement is achieved with three values you can try to improve the results by changing the default values for the initial guess of the fitted parameters and their allowed ranges. This requires more knowledge in R and is discussed below.</p>
<h2 id="uploading-your-own-data">Uploading Your Own Data</h2>
<h2 id="editing-the-parameter-file">Editing the Parameter File</h2>
<p>The fit and forecast generating functions of PROF contain default parameter values that 
are pathogen specific.  However, the user may customize these parameters by altering the 
parameter list structure.  The customized parameter specification can then be saved to 
a YAML file for later use/reference.  PROF provides two methods for initializing a 
parameter list structure:</p>
<ol>
<li>Use PROF::init_par_list().  Here is an example for working with a single disease 
   (COVID-19), using an SEIR model to produce hospitalizations.
   <code>R
   library(PROF)
   # to generate the parameter structure for a single disease
   par_list1 = init_par_list(diseases=c("covid19"),
                            models=c("seirh"))
   str(par_list1)</code>
   Here is a second example for working with two diseases (COVID-19, Influenza), using 
   an SEIR model for COVID-19 hospitalizations and SIR for influenza.
   <code>R
   # generate a multi-disease parameter structure
   par_list2 = init_par_list(diseases=c("covid19", "influenza"),
                            models=c("seirh", "sirh"))
   str(par_list2)</code></li>
<li>Use the YAML template located in the 'parameters' directory of PROF: 
   <code>PROF/parameters/param_exmpl.yml</code>
   The YAML file can be copied and customized using a text editor, or by loading into R:
   <code>R
   par_list = PROF::read_par_list_yaml(file_path=".../PROF/parameters/param_exmpl.yml")</code>
The parameter list is initialized with almost all values assigned NAs.  Any disease parameter
whose value remains NA when passed to PROF will have its value set by PROF::init_param().<br />
Manually setting a parameter is straightforward.  For example to set the influenza 
generation-time to 3.5 days:</li>
</ol>
<pre><code class="language-R">par_list$influenza$dis_par_ranges$par$gamma = 1/3.5
</code></pre>
<p>Explain initial conditions estimated by PROF::est_I0().</p>
<p>Explain which parameters can be/are optimized.</p>
<p>Explain parameter ranges.</p>
<p>Describe each parameter: initial, disease, mcmc...?</p>
<p>When changes are complete (if editing the list in R), the parameter list can be saved to YAML format for future 
reference:</p>
<pre><code class="language-R">PROF::write_par_list_yaml(par_list=par_list, file_path=&quot;my_dir/test.yml&quot;)
</code></pre>
<h2 id="inferring-mortality">Inferring Mortality</h2>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../example/" class="btn btn-neutral" title="PROF Command Line Tutorial"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/predsci/PROF/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../example/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
      <script src="../javascripts/config.js" defer></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6" defer></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
