{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"PROF Welcome to the documentation site for the PROF package. PROF is an R package (with Fortran code) for fitting and forecasting infectious disease incidence. The package ingests publicly-available confirmed hospital admission data, fits mechanistic models to the data, and provides short-term probabilistic forecasts. Currently, the package supports fitting and forecasting the individual and combined burden of influenza and COVID-19 at the state level. S[I]2HR and SE[I]2HR models are used to fit the two pathogens and both models use a flexible, time-dependent transmission term. Once the User selects a state, and either one or both viruses, the PROF fitting procedure iteratively determines the joint posterior distribution of model parameters. The joint posterior distribution is then used with the model to generate location-specific probabilistic forecasts of the near-term number of hospital admissions. If both viruses are chosen, this procedure is done twice and the total hospital burden forecast is estimated by combining the trajectory profiles of each disease in multiple ways, including random, ordered, and semi-ordered. Data PROF provides full support for downloading the most up-to-date daily confirmed hospital admission data for COVID-19 and influenza. The data set is provided by the U.S. Department of Health & Human Services, is updated weekly on Friday, and is called: \"COVID-19 Reported Patient Impact and Hospital Capacity by State (RAW)\". For more on the data set, see here . Compartmental Models PROF uses compartmental models with a flexible, time-dependent transmission term to fit daily hospitalization data. For both COVID-19 and influenza, the models include a hospitalization compartment which is split into two sub-compartments. This split ensures that the model preserves the correct generation time (T g ) and that the ratio between cumulative recovered and hospitalized individuals is determined by the infection-hospitalization-ratio (p H ). For influenza, individuals begin in the susceptible compartment. If exposed, they transition (\u03b2(t)) to the infectious compartment where there is a probability of hospitalization or recovery (p H /1-p H ) Individuals progress (1/\u03bc) from the first hospitalization compartment (H 1 ) to the second (H 2 ), and the number entering this compartment is recorded as daily incidence (and optimized, see below). A similar model is used for COVID-19 with the only difference being the addition of the Exposed (but not yet infectious) compartment. While we recommend utilizing the SIRH model for influenza and SEIRH for COVID-19, PROF is flexible and supports the fitting of either model to either pathogen. Time-Dependent Force of Infection We use a smoothly varying two-value functional form to describe the time-dependent reproduction number: R(t) = \u03b2(t)\u03b3, where \u03b2(t) is the time-dependent transmission rate is \u03b3 is the total recovery rate. $$R(t)=\\frac{1}{2}\\left( R_{0} + R_{1} + (R_{1}-R_{0})tanh\\left( \\frac{t-t_{0}}{L} \\right) \\right)$$ The above equation produces a smooth curve where at roughly time t 0 the value of R(t) transitions from R 0 to R 1 with an approximate transition time of ~2L days. Methodology - Fitting, Forecasting, and Combined Burden PROF fits each pathogen independently and sequentially. For each pathogen, we determine the joint posterior distribution of model parameters by fitting the daily confirmed hospital admission time series using an adaptive-step-size MCMC procedure. Only parameters that govern the time variation of R(t) and the probability of hospitalization are optimized and all other parameters are taken from the literature. By default, a fast Fortran code is used for the MCMC procedure (in the future, we hope to be able to offer a second, slower-but-faster-than-R, option that does not require a Fortran compiler). Once the fitting of one pathogen is completed, PROF proceeds to fit the second pathogen. The posterior distribution of each fit can be used to (1) Create a probabilistic plot of the fit, (2) Create a probabilistic forecast (and plot thereof) for each pathogen. The final step for PROF is providing an estimate for the forecast of the combined burden. Currently, the combined burden is estimated in two ways (1) By summing the sorted trajectories of each pathogen (implying a perfect correlation between the errors of the two forecasts), or (2) By randomly summing the trajectories (implying no correlation between the errors of the two forecasts). In the near future, we plan to offer a third alternative which is based on an error correlation procedure we are working on. Baseline Statistical Model In addition to fitting and forecasting the data with a compartmental model PROF will fit and forecast the data to a baseline statistical model. For weekly data, the median prediction of the baseline forecast is the corresponding target value observed in the previous week, and noise around the median prediction is generated using positive and negative 1-week differences (that is differences between consecutive reports) for all prior observations. The resulting sampling distribution is truncated to prevent negative values. PROF implements this model using daily data.","title":"Home"},{"location":"#prof","text":"Welcome to the documentation site for the PROF package. PROF is an R package (with Fortran code) for fitting and forecasting infectious disease incidence. The package ingests publicly-available confirmed hospital admission data, fits mechanistic models to the data, and provides short-term probabilistic forecasts. Currently, the package supports fitting and forecasting the individual and combined burden of influenza and COVID-19 at the state level. S[I]2HR and SE[I]2HR models are used to fit the two pathogens and both models use a flexible, time-dependent transmission term. Once the User selects a state, and either one or both viruses, the PROF fitting procedure iteratively determines the joint posterior distribution of model parameters. The joint posterior distribution is then used with the model to generate location-specific probabilistic forecasts of the near-term number of hospital admissions. If both viruses are chosen, this procedure is done twice and the total hospital burden forecast is estimated by combining the trajectory profiles of each disease in multiple ways, including random, ordered, and semi-ordered.","title":"PROF"},{"location":"#data","text":"PROF provides full support for downloading the most up-to-date daily confirmed hospital admission data for COVID-19 and influenza. The data set is provided by the U.S. Department of Health & Human Services, is updated weekly on Friday, and is called: \"COVID-19 Reported Patient Impact and Hospital Capacity by State (RAW)\". For more on the data set, see here .","title":"Data"},{"location":"#compartmental-models","text":"PROF uses compartmental models with a flexible, time-dependent transmission term to fit daily hospitalization data. For both COVID-19 and influenza, the models include a hospitalization compartment which is split into two sub-compartments. This split ensures that the model preserves the correct generation time (T g ) and that the ratio between cumulative recovered and hospitalized individuals is determined by the infection-hospitalization-ratio (p H ). For influenza, individuals begin in the susceptible compartment. If exposed, they transition (\u03b2(t)) to the infectious compartment where there is a probability of hospitalization or recovery (p H /1-p H ) Individuals progress (1/\u03bc) from the first hospitalization compartment (H 1 ) to the second (H 2 ), and the number entering this compartment is recorded as daily incidence (and optimized, see below). A similar model is used for COVID-19 with the only difference being the addition of the Exposed (but not yet infectious) compartment. While we recommend utilizing the SIRH model for influenza and SEIRH for COVID-19, PROF is flexible and supports the fitting of either model to either pathogen.","title":"Compartmental Models"},{"location":"#time-dependent-force-of-infection","text":"We use a smoothly varying two-value functional form to describe the time-dependent reproduction number: R(t) = \u03b2(t)\u03b3, where \u03b2(t) is the time-dependent transmission rate is \u03b3 is the total recovery rate. $$R(t)=\\frac{1}{2}\\left( R_{0} + R_{1} + (R_{1}-R_{0})tanh\\left( \\frac{t-t_{0}}{L} \\right) \\right)$$ The above equation produces a smooth curve where at roughly time t 0 the value of R(t) transitions from R 0 to R 1 with an approximate transition time of ~2L days.","title":"Time-Dependent Force of Infection"},{"location":"#methodology-fitting-forecasting-and-combined-burden","text":"PROF fits each pathogen independently and sequentially. For each pathogen, we determine the joint posterior distribution of model parameters by fitting the daily confirmed hospital admission time series using an adaptive-step-size MCMC procedure. Only parameters that govern the time variation of R(t) and the probability of hospitalization are optimized and all other parameters are taken from the literature. By default, a fast Fortran code is used for the MCMC procedure (in the future, we hope to be able to offer a second, slower-but-faster-than-R, option that does not require a Fortran compiler). Once the fitting of one pathogen is completed, PROF proceeds to fit the second pathogen. The posterior distribution of each fit can be used to (1) Create a probabilistic plot of the fit, (2) Create a probabilistic forecast (and plot thereof) for each pathogen. The final step for PROF is providing an estimate for the forecast of the combined burden. Currently, the combined burden is estimated in two ways (1) By summing the sorted trajectories of each pathogen (implying a perfect correlation between the errors of the two forecasts), or (2) By randomly summing the trajectories (implying no correlation between the errors of the two forecasts). In the near future, we plan to offer a third alternative which is based on an error correlation procedure we are working on.","title":"Methodology - Fitting, Forecasting, and Combined Burden"},{"location":"#baseline-statistical-model","text":"In addition to fitting and forecasting the data with a compartmental model PROF will fit and forecast the data to a baseline statistical model. For weekly data, the median prediction of the baseline forecast is the corresponding target value observed in the previous week, and noise around the median prediction is generated using positive and negative 1-week differences (that is differences between consecutive reports) for all prior observations. The resulting sampling distribution is truncated to prevent negative values. PROF implements this model using daily data.","title":"Baseline Statistical Model"},{"location":"about/","text":"About the Project The development of PROF is supported by the Council of State and Territorial Epidemiologists (CSTE) and the Centers for Disease Control and Prevention (CDC) through cooperative agreement number NU38OT000297, as part of the \"Development of forecast, analytic, and visualization tools to improve outbreak response and support public health decision-making\" project. References Ben-Nun et al. 2022 Riley et al. 2023 Turtle et al. (2023) - Epidemics, Submitted Contact Michal Ben-Nun : mbennun@predsci.com James Turtle : jturtle@predsci.com Pete Riley : pete@predsci.com","title":"About"},{"location":"about/#about-the-project","text":"The development of PROF is supported by the Council of State and Territorial Epidemiologists (CSTE) and the Centers for Disease Control and Prevention (CDC) through cooperative agreement number NU38OT000297, as part of the \"Development of forecast, analytic, and visualization tools to improve outbreak response and support public health decision-making\" project.","title":"About the Project"},{"location":"about/#references","text":"Ben-Nun et al. 2022 Riley et al. 2023 Turtle et al. (2023) - Epidemics, Submitted","title":"References"},{"location":"about/#contact","text":"Michal Ben-Nun : mbennun@predsci.com James Turtle : jturtle@predsci.com Pete Riley : pete@predsci.com","title":"Contact"},{"location":"install/","text":"PROF Installation Instructions This R package requires an R or RStudio installation and Fortran/GCC compilers. Using 'devtools' in an R console > library(devtools) > install_git(url=\"https://github.com/predsci/PROF\") Cloning through GitHub Users are also welcome to directly download the package either as a zip or by cloning the repository. To clone: git clone https://github.com/predsci/PROF.git Then Open an R or RStudio session. Navigate to the location of the cloned project, open the PROF.Rproj file and install the package.","title":"Install"},{"location":"install/#prof-installation-instructions","text":"This R package requires an R or RStudio installation and Fortran/GCC compilers.","title":"PROF Installation Instructions"},{"location":"install/#using-devtools-in-an-r-console","text":"> library(devtools) > install_git(url=\"https://github.com/predsci/PROF\")","title":"Using 'devtools' in an R console"},{"location":"install/#cloning-through-github","text":"Users are also welcome to directly download the package either as a zip or by cloning the repository. To clone: git clone https://github.com/predsci/PROF.git Then Open an R or RStudio session. Navigate to the location of the cloned project, open the PROF.Rproj file and install the package.","title":"Cloning through GitHub"},{"location":"setup/","text":"Setup We have setup an example.R script and suggest that you give it a try after installing the package. This example has been configured for fitting and forecasting influenza and COVID-19 data for any of the 50 states D.C. and Puerto Rico for the 2021-22, 2022-23, or 2023-24 seasons. All available data is first downloaded and then the data for the requested location is retrieved and processed. You can fit the entire requested season or just part of it. Below we demonstrate both options. We start by opening an R or RStudio session and loading the PROF package: > library(PROF) We then download the HHS data using the provided 'hhs_hosp_state_down' function > result = hhs_hosp_state_down(down_dir=\"~/Downloads\") We can check to see if the download was successful: > result$out_flag The above should be zero. We now select a state and a season > state = \"CA\" > season = 2023 and extract the data: > prof_data = hhs_2_PROF(hhs_path=result$download_path, season = season, state=state) You can select other states or any of the two previous seasons (2021 and 2022). The 'prof_data' data structure should now be available and the data can be plotted to the screen: > plot_prof_data(prof_data = prof_data) Plots can also be saved to a file using: > plot_prof_data(prof_data = prof_data, filename = '/path/to/filename') Next we will add 'fit data' structure to each pathogen - this is the data that will be fitted using a mechanistic compartmental model. NULL values for start/end dates mean set to start/end of the season data, and fit all available data: prof_data = hhs_set_fitdates(prof_data=prof_data, fit_start=NULL, fit_end=NULL) To fit only part of the data use for example: prof_data = hhs_set_fitdates(prof_data=prof_data, fit_start=NULL, fit_end=\"2023-10-28\") If you would like to fit only part of the data we recommend using the interactive plots of the data for selecting the 'fit_end' date. Next we load the parameters for the models (for more details see the R/ex_par_list.R script): > par_list = init_par_list(diseases=c(\"covid19\", \"influenza\"), models=c(\"seirh\", \"sirh\")) The above call tells PROF that we would like to fit SEIRH/SIRH models to the COVID-19/influenza data. To fit an SEIRH model for both COVID-19 and influenza use: > par_list = init_par_list(diseases=c(\"covid19\", \"influenza\"), models=c(\"seirh\", \"seirh\")) We can now sequentially fit both pathogens using the compartmental models we selected: > fit_list <- fit_data(prof_data = prof_data, par_list = par_list) You can now sit and relax for 10-15 minutes To save the results of the fit (posterior distribution and initial state) use: > saveRDS(fit_list, filename = '/path/to/filename.rds') To plot the results of the fit to the screen use: > fit_traj <- plot_fit(prof_data = prof_data, par_list = par_list, fit_list = fit_list) The plotting routine returns a list with the following elements: fit_traj - a list for each disease containing: model fit mechanistic trajectories, dates, and reported incidence pl - a list of ggplot2 objects one for each disease for the mechanistic plots To save the plot to a file use: > fit_traj <- plot_fit(prof_data = prof_data, par_list = par_list, fit_list = fit_list, filename = '/path/to/filename') Please note that by default this routine also plots the results of fitting a baseline statistical model to the data. Early in the season this may provide a reasonable fit and forecast. To plot the results of fitting a baseline statistical mode to each pathogen use: > stat_fit_list <- plot_stat_fit(prof_data = prof_data) The above call returns a list with the following elements: stat_fit_traj - a list for each disease containing: baseline statistical fit trajectories, dates, and reported incidence pl_stat - a list of ggplot2 objects one for each disease for the statistical plots To use the posterior distributions of the fits to create individual forecasts and a combined burden forecast use: > forecast_traj <- plot_forecast(prof_data = prof_data, par_list = par_list, fit_list = fit_list) Please note that we currently provide two versions of the combined forecast: random (bottom left panel), and sorted (bottom right panel). The plotting routine returns a list with four elements ('covid19', 'influenza', 'random', and 'sorted'). Random and Sorted are the combined burden calculated with random and sorted selection of trajectories, respectively. Each element is a list with the trajectories used to create the plots, the date array and the reported incidence array. To also save the plot to a file use: > forecast_traj <- plot_forecast(prof_data = prof_data, par_list = par_list, fit_list = fit_list, filename = '/path/to/filename') PROF can also be used to fit and forecast using a fast baseline statistical model. The procedure follows the steps we have taken for the compartmental mechanistic model. First, we add 'fit-stat data ' structure to each pathogen - this is the data that will be fitted using a baseline statistical model. NULL values for start/end dates mean set to start/end of the season data, and fit all available data: prof_data = hhs_set_fitdates_stat(prof_data=prof_data, fit_start=NULL, fit_end=NULL) To fit and plot the results we use: stat_fit_list <- plot_stat_fit(prof_data = prof_data, ntarj = 1e4, filename = NULL) Here we have set the number of trajectories to 10,000 (default is 1,000). To save the plots to a file use: stat_fit_list <- plot_stat_fit(prof_data = prof_data, ntarj = 1e4, filename = 'path/to/filename') To use the baseline statistical model to create a 42 day forward forecast and the two estimates for the combined burden use: > stat_forecast_list <- plot_stat_forecast(prof_data = prof_data, nfrcst = 42) For the combined burden of the baseline statistical model we offer the same two options (random and sorted). The statistical plotting routine returns a list with the same four elements as the one for the mechanistic forecasts For both the mechanistic and statistical options the number of forecast horizons is set by the parameter 'nfrcst' above. By default it is set to 35. The cadence (i.e., units) of this parameter are assumed to be the same as that of the incidence data.","title":"Setup"},{"location":"setup/#setup","text":"We have setup an example.R script and suggest that you give it a try after installing the package. This example has been configured for fitting and forecasting influenza and COVID-19 data for any of the 50 states D.C. and Puerto Rico for the 2021-22, 2022-23, or 2023-24 seasons. All available data is first downloaded and then the data for the requested location is retrieved and processed. You can fit the entire requested season or just part of it. Below we demonstrate both options. We start by opening an R or RStudio session and loading the PROF package: > library(PROF) We then download the HHS data using the provided 'hhs_hosp_state_down' function > result = hhs_hosp_state_down(down_dir=\"~/Downloads\") We can check to see if the download was successful: > result$out_flag The above should be zero. We now select a state and a season > state = \"CA\" > season = 2023 and extract the data: > prof_data = hhs_2_PROF(hhs_path=result$download_path, season = season, state=state) You can select other states or any of the two previous seasons (2021 and 2022). The 'prof_data' data structure should now be available and the data can be plotted to the screen: > plot_prof_data(prof_data = prof_data) Plots can also be saved to a file using: > plot_prof_data(prof_data = prof_data, filename = '/path/to/filename') Next we will add 'fit data' structure to each pathogen - this is the data that will be fitted using a mechanistic compartmental model. NULL values for start/end dates mean set to start/end of the season data, and fit all available data: prof_data = hhs_set_fitdates(prof_data=prof_data, fit_start=NULL, fit_end=NULL) To fit only part of the data use for example: prof_data = hhs_set_fitdates(prof_data=prof_data, fit_start=NULL, fit_end=\"2023-10-28\") If you would like to fit only part of the data we recommend using the interactive plots of the data for selecting the 'fit_end' date. Next we load the parameters for the models (for more details see the R/ex_par_list.R script): > par_list = init_par_list(diseases=c(\"covid19\", \"influenza\"), models=c(\"seirh\", \"sirh\")) The above call tells PROF that we would like to fit SEIRH/SIRH models to the COVID-19/influenza data. To fit an SEIRH model for both COVID-19 and influenza use: > par_list = init_par_list(diseases=c(\"covid19\", \"influenza\"), models=c(\"seirh\", \"seirh\")) We can now sequentially fit both pathogens using the compartmental models we selected: > fit_list <- fit_data(prof_data = prof_data, par_list = par_list) You can now sit and relax for 10-15 minutes To save the results of the fit (posterior distribution and initial state) use: > saveRDS(fit_list, filename = '/path/to/filename.rds') To plot the results of the fit to the screen use: > fit_traj <- plot_fit(prof_data = prof_data, par_list = par_list, fit_list = fit_list) The plotting routine returns a list with the following elements: fit_traj - a list for each disease containing: model fit mechanistic trajectories, dates, and reported incidence pl - a list of ggplot2 objects one for each disease for the mechanistic plots To save the plot to a file use: > fit_traj <- plot_fit(prof_data = prof_data, par_list = par_list, fit_list = fit_list, filename = '/path/to/filename') Please note that by default this routine also plots the results of fitting a baseline statistical model to the data. Early in the season this may provide a reasonable fit and forecast. To plot the results of fitting a baseline statistical mode to each pathogen use: > stat_fit_list <- plot_stat_fit(prof_data = prof_data) The above call returns a list with the following elements: stat_fit_traj - a list for each disease containing: baseline statistical fit trajectories, dates, and reported incidence pl_stat - a list of ggplot2 objects one for each disease for the statistical plots To use the posterior distributions of the fits to create individual forecasts and a combined burden forecast use: > forecast_traj <- plot_forecast(prof_data = prof_data, par_list = par_list, fit_list = fit_list) Please note that we currently provide two versions of the combined forecast: random (bottom left panel), and sorted (bottom right panel). The plotting routine returns a list with four elements ('covid19', 'influenza', 'random', and 'sorted'). Random and Sorted are the combined burden calculated with random and sorted selection of trajectories, respectively. Each element is a list with the trajectories used to create the plots, the date array and the reported incidence array. To also save the plot to a file use: > forecast_traj <- plot_forecast(prof_data = prof_data, par_list = par_list, fit_list = fit_list, filename = '/path/to/filename') PROF can also be used to fit and forecast using a fast baseline statistical model. The procedure follows the steps we have taken for the compartmental mechanistic model. First, we add 'fit-stat data ' structure to each pathogen - this is the data that will be fitted using a baseline statistical model. NULL values for start/end dates mean set to start/end of the season data, and fit all available data: prof_data = hhs_set_fitdates_stat(prof_data=prof_data, fit_start=NULL, fit_end=NULL) To fit and plot the results we use: stat_fit_list <- plot_stat_fit(prof_data = prof_data, ntarj = 1e4, filename = NULL) Here we have set the number of trajectories to 10,000 (default is 1,000). To save the plots to a file use: stat_fit_list <- plot_stat_fit(prof_data = prof_data, ntarj = 1e4, filename = 'path/to/filename') To use the baseline statistical model to create a 42 day forward forecast and the two estimates for the combined burden use: > stat_forecast_list <- plot_stat_forecast(prof_data = prof_data, nfrcst = 42) For the combined burden of the baseline statistical model we offer the same two options (random and sorted). The statistical plotting routine returns a list with the same four elements as the one for the mechanistic forecasts For both the mechanistic and statistical options the number of forecast horizons is set by the parameter 'nfrcst' above. By default it is set to 35. The cadence (i.e., units) of this parameter are assumed to be the same as that of the incidence data.","title":"Setup"}]}